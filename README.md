# PWM demo

Тестовый проект, 4 канала ШИМ, 2 канала ассиметричного (0, 1) и 2 канала симметричного (2, 3). 

Xilinx Vivado 2018.3

## TO DO

* **Синтез:**
    - Тактовые частоты кратные степеням двойки.
    - Инкремент 1 и подстройка опоры под сигнал (отрезка битов с информационного сигнала).
* **Файлы ограничений для плат**

## Используемые отладочные платы

[MYiR Z-turn Board V2](https://www.myirtech.com/list.asp?id=708)

[Microphase-Z7-Lite
](https://github.com/hw/Microphase-Z7-Lite)

## Структура

```
pwm_demo
├── src
│   ├── pwm_platform.vhd // верхний уровень
│   ├── pwm_l.vhd // ассиметричный (левый) ШИМ
│   ├── pwm_c.vhd // симметричный (центрированный) ШИМ
├── tb
│   ├── tb_pwm_platform.vhd // test bench
├── ip
│   ├── dds_compiler_0 // генератор тестового синуса
└──
```

## Конфигурация

* Тактовая частота 100 МГц, период 10 нс (плоская вершина 5 нс).
* Разрешение тестового сигнала и опорного (счетчика для ШИМ) сигналов 16 бит (0 - 65535).
* Частота опорного сигнала из dds compiler'а - 15.258 кГц (точность настройки зависит также от установленной тактовой частоты).
* Разрешение и частоты ШИМ:

    | Инкремент | Частота ШИМ, МГц | Разрешение, бит | 
    |---|---|---|
    | 1 | 0.001525 | 15.9 |
    | 3 | 0.004577 | 14.4 |
    | 5 | 0.007629 | 13.7 |
    | 51 | 0.077821 | 10.3 |
    | 255 | 0.389105 | 8.0 |
    | 771 | 1.176470 | 4.4 |

### Пояснение к таблице

Разрешение сигналов по 16 бит. Возможный диапазон значений от 0 до 65535. Тогда, чтобы иметь целые кратные шаги опорного сигнала в ШИМ необходимо делить 65535 нацело иначе потребуется сложный неточный код для подстройки опоры под модулируемый сигнал (как я делал в магистерской), или необходимо использовать числа с плавающей точкой.

Все делители числа 65 535: 
1, 3, 5, 15, 17, 51, 85, 255, 257, 771, 1285, 3855, 4369, 13107, 21845, 65535. 

Эти делители и есть инкременты для счетчика опорного сигнала. 

$$ PWM\_Levels = \frac{2^R-1}{Increment} = \frac{2^{16} - 1 = 65535}{51} = 1285 $$

$$ f_{PWM} = \frac{f_{clk}}{PVM\_Levels} = \frac{100 \cdot 10^6}{1285} = 0.077821 = 77.8\, кГц $$

$$ PWM\_Resolution = \log_2(PWM\_Levels) = \log_2(1285) = 10.3\, бит $$






